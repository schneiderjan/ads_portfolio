<!DOCTYPE html>
<html>
	
	<head>
		<title> Jan-Niklas Schneider </title>
		<link href='css/nav.css' rel="stylesheet" type="text/css">
		<link href='css/main.css' rel="stylesheet" type="text/css">
		<link href='css/tooltip.css' rel="stylesheet" type="text/css">
		<link href='960-Grid-System-master/code/css/960_12_col_rtl.css' rel="stylesheet" type="text/css">
		<link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"/>
		<script src="//code.jquery.com/ui/1.10.4/jquery-ui.js"/>
		<script src="http://d3js.org/d3.v3.min.js"/>
	</head>
	
	<body>
		
		<nav>
			<ul>
				<li>
					<a href="index.html"> Home</a>
				</li>
			</ul>
		</nav>
		
		<div class="container_12">
			<div class="grid_12">
				<div class="extra-padding">
					
					<form>
						<label>
						<input type="radio" name="mode" value="population" checked> Population distribution</label>
						<label>
						<input type="radio" name="mode" value="revenue"> Revenue</label>
					</form>
					
					<script>
						
					var margin = { top: 40, right: 10, bottom: 10, left: 10 },
					width = 960 - margin.left - margin.right,
					height = 500 - margin.top - margin.bottom;
					
					var percentage = function(d) { return d["percentage"]; };
					var revenue    = function(d) { return d["revenue"]; };
					
					var colorScale = d3.scale.category20c();
					var color = function(d) { return d.children ? colorScale(d["Group"]) : null; }
					
					var treemap = d3.layout.treemap()
					.size([width, height])
					.sticky(true)
					.value(percentage);
					
					var div = d3.select("body").append("div")
					.style("position", "relative")
					.style("width", (width + margin.left + margin.right) + "px")
					.style("height", (height + margin.top + margin.bottom) + "px")
					.style("left", margin.left + "px")
					.style("top", margin.top + "px");
					
					var mousemove = function(d) {
					var xPosition = d3.event.pageX + 5;
					var yPosition = d3.event.pageY + 5;
					
					d3.select("#tooltip")
					.style("left", xPosition + "px")
					.style("top", yPosition + "px");
					d3.select("#tooltip #heading")
					.text(d["demographics"]["Group"] + " - " + d["demographics"]["Group description"]);
					d3.select("#tooltip #percentage")
					.text(d["demographics"]["Type description"] + "\n" + d["percentage"] + "%");
					d3.select("#tooltip #revenue")
					.text("Â£" + d["revenue"].toFixed(0));
					d3.select("#tooltip").classed("hidden", false);
					};
					
					var mouseout = function() {
					d3.select("#tooltip").classed("hidden", true);
					};
					
					var randomRevenue = function(data) {
					var rows = [];
					data.forEach(function(d){
					if (Math.random() < 0.75) {
					rows.push({"Group": d["Group"],
					"Type": d["Type"],
					"Revenue": Math.random() * 100});
					}
					});
					return rows;
					}
					
					var groupData = function(groupings, data, key){
					data.forEach(function(d){
					if(!groupings[d["Group"]]) {
					groupings[d["Group"]] = {};
					}
					if(!groupings[d["Group"]][d["Type"]]) {
					groupings[d["Group"]][d["Type"]] = {};
					}
					groupings[d["Group"]][d["Type"]][key] = d;
					});
					}
					
					d3.csv("demographics.csv", function(error, data) {
					
					var revenueData = randomRevenue(data);
					
					var groupings = {}
					groupData(groupings, data, "demographics");
					groupData(groupings, revenueData, "revenue");
					
					var trees = [];
					for(group in groupings){
					var children = [];
					for(type in groupings[group]){
					var elm = groupings[group][type];
					elm["percentage"] = elm["demographics"]["Percentage"];
					elm["revenue"] = elm["revenue"]
					? parseFloat(elm["revenue"]["Revenue"])
					: 0.0;
					children.push(elm);
					}
					trees.push({"children": children,
					"Group": group});
					}
					var root = {"children": trees};
					
					var node = div.datum(root).selectAll(".node")
					.data(treemap.nodes)
					.enter().append("div")
					.attr("class", "node")
					.call(position)
					.style("background", color)
					.on("mousemove", mousemove)
					.on("mouseout", mouseout);
					
					d3.selectAll("input").on("change", function change() {
					var value = this.value === "population" ? percentage : revenue;
					
					node
					.data(treemap.value(value).nodes)
					.transition()
					.duration(1500)
					.call(position);
					});
					});
					
					function position() {
					this.style("left", function(d) { return d.x + "px"; })
					.style("top", function(d) { return d.y + "px"; })
					.style("width", function(d) { return Math.max(0, d.dx - 2) + "px"; })
					.style("height", function(d) { return Math.max(0, d.dy - 2) + "px"; });
					}
					</script>
					
					<div id="tooltip" class="hidden">
					<p>
					<strong id="heading"/>
					</p>
					<p>
					<span id="percentage"/>
					</p>
					<p>
					<span id="revenue"/>
					</p>
					</div>
					
					
					
					</div>
					</div>
					</div>
					
					</body>
					
					</html>					